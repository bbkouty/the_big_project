<%# app/views/gossips/show.html.erb #%>

<div class="card shadow-lg mb-4">
  <div class="card-body">
    <h2 class="card-title text-success"><%= @gossip.title %></h2>
    <p class="card-text"><%= @gossip.content %></p>

    <p>
      ðŸ‘¤ Auteur : 
      <%= link_to @gossip.user.first_name, user_path(@gossip.user), class: "text-decoration-none fw-bold" %>
      <span class="text-muted">- ðŸŒ† <%= link_to @gossip.user.city.name, city_path(@gossip.user.city), class: "text-decoration-none" %></span>
    </p>
  </div>

  <div class="mb-3">
    <% if current_user %>
      <% if @gossip.likes.exists?(user: current_user) %>
        <%= button_to "ðŸ‘liked", gossip_like_path(@gossip),
          method: :delete, class: "btn btn-outline-success btn-sm" %>
      <% else %>
        <%= button_to "ðŸ‘Like?", gossip_likes_path(@gossip),
          method: :post, class: "btn btn-outline-primary btn-sm" %>
      <% end %>
    <% else %>
      <small class="text-muted">Connectez-vous pour liker</small>
    <% end %>
    <span class="badge bg-info ms-2"><%= @gossip.likes.count %> likes</span>
  </div>

  <div class="card-body">
    <h4>Commentaires (<%= @gossip.comments.count %>)</h4>

    <%= form_with(model: [@gossip, @comment]) do |f| %>
      <%= f.text_area :content, class: "form-control", placeholder: "Ã‰crire un commentaire..." %>
      <%= f.submit "Ajouter", class: "btn btn-primary mt-2" %>
    <% end %>

    <ul class="list-group mt-3 mb-3">
      <% @comments.each do |comment| %>
        <li class="list-group-item">
          <div class="d-flex justify-content-between align-items-start">
            <span>
              <strong><%= comment.user.first_name %>:</strong> <%= comment.content %>
            </span>

            <% if comment.user == current_user %>
              <div class="d-flex gap-1">
                <!-- Modifier le commentaire -->
                <%= link_to "âœ", edit_gossip_comment_path(@gossip, comment), class: "btn btn-sm btn-outline-success" %>

                <!-- Supprimer le commentaire -->
                <%= button_to "ðŸ—‘", gossip_comment_path(@gossip, comment), method: :delete, data: { confirm: "ÃŠtes-vous sÃ»r de vouloir supprimer ce commentaire ?" }, class: "btn btn-sm btn-outline-danger" %>
              </div>
            <% end %>
          </div>
        </li>
      <% end %>
    </ul>
    
    <div class="card-footer d-flex justify-content-between align-items-center mt-3">
      <small class="text-muted">CrÃ©Ã© le <%= @gossip.created_at.strftime("%d/%m/%Y Ã  %H:%M") %></small>

      <div class="d-flex gap-2">
        <%= link_to "â¬… Retour aux potins", root_path, class: "btn btn-secondary" %>
        <% if @gossip.user == current_user %>
          <%= link_to "âœ Modifier le potin", edit_gossip_path(@gossip), class: "btn btn-success" %>
          <%= form_with(model: @gossip, method: :delete, data: { confirm: "ÃŠtes-vous sÃ»r ?" }, class: "d-inline") do |f| %>
            <%= f.submit "ðŸ—‘ Supprimer le potin", class: "btn btn-danger" %>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>
